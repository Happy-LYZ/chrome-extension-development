{"version":3,"file":"js/background.js","sources":["webpack:///webpack/bootstrap 2e0e4fdd7c71cae8836f","webpack:///app/background.js","webpack:///app/utils/animateIcon/index.js","webpack:///app/utils/options.js"],"sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"../dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./app/background.js\");\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2e0e4fdd7c71cae8836f","import Options from './utils/options';\nimport animateIcon from './utils/animateIcon';\n\nconst chrome = window.chrome;\n\n//将Options操作对象添加到window域下，以供扩展其它部分访问\nwindow.extensionOptions = Options;\n\nchrome.runtime.onMessage.addListener((data, sender, sendResponse) => {\n    switch (data.action) {\n        case 'executeScript':\n            chrome.tabs.executeScript(null, { code: data.code });\n            break;\n        case 'insertCSS':\n            chrome.tabs.insertCSS(null, { code: data.code });\n            break;\n\n        case 'getOption':\n            sendResponse(Options.get(data.key));\n            break;\n\n        case 'setOption':\n            sendResponse(Options.set(data.key, data.value));\n            break;\n\n        case 'updateOption':\n            if(animateIcon.running !== Options.get('animateIcon')) {\n                Options.get('animateIcon') ? animateIcon.start() : animateIcon.stop();\n            }\n            break;\n\n        default: //nothing todo\n            break;\n    }\n});\n\nchrome.tabs.onActivated.addListener(({tabId}) => {\n    chrome.tabs.sendMessage(tabId, {\n        action: 'active'\n    });\n});\n\nif( Options.get('animateIcon')) {\n    animateIcon.start();\n}\n\n\n\n// WEBPACK FOOTER //\n// app/background.js","const chrome = window.chrome;\nconst originImg = new Image();\nconst defaultIconUrl = window.chrome.runtime.getURL('icons/icon_16.png');\n\noriginImg.src = defaultIconUrl;\n\nexport default {\n    running: false,\n    angle: 0,\n\n    start() {\n        this.running = true;\n\n        this.render();\n    },\n\n    stop() {\n        this.running = false;\n        this.angle = 0;\n\n        clearTimeout(this.timer);\n\n        chrome.browserAction.setIcon({\n            path: defaultIconUrl\n        });\n    },\n\n    render() {\n        const imageData = this.getImageData();\n\n        chrome.browserAction.setIcon({\n            imageData\n        });\n\n        this.angle = (this.angle + 5) % 360;\n\n        this.timer = setTimeout(this.render.bind(this), 100);\n    },\n\n    getImageData() {\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n\n        canvas.width = canvas.height = 32;\n\n        ctx.translate(canvas.width / 2, canvas.height / 2);\n        ctx.rotate(this.angle * Math.PI / 180);\n        ctx.drawImage(originImg, -canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);\n\n        return ctx.getImageData(0, 0, canvas.width, canvas.height);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// app/utils/animateIcon/index.js","const chrome = window.chrome;\nconst KEY = 'chrome-extension-options';\nlet options;\n\n//从localstorage中取得设置数据\ntry {\n    options = JSON.parse(localStorage.getItem(KEY)) || {};\n} catch (e) {\n    options = {};\n}\n\n//获取对background运行的页面window对象引用\nlet backgroundWindow;\n\n//放到try catch代码块中是因为getBackgroundPage方法在content scripts中是访问不了的\ntry {\n    backgroundWindow = chrome.extension.getBackgroundPage();\n} catch(e) {}\n\nexport default Object.assign({\n    options,\n\n    /*!\n     * @desc get与set供background中直接调用\n     *      不要在browser action或者content scirpts中直接调用该方法\n     *      前者可能导致状态不一致，或者会设置失败（content scripts是共享所在页面的bom dom）\n     */\n    get(key) {\n        return key === undefined ? options : options[key];\n    },\n\n    set(key, value) {\n        options[key] = value;\n\n        localStorage.setItem(KEY, JSON.stringify(options));\n\n        return options;\n    }\n}, backgroundWindow === window ? null : {\n    /*!\n     * @desc 在content scripts或者browser action等环境中需要使用该方法\n     *      getAsync、setAsync是通过扩展通信接口实现的异步方法, @return 返回 Promise 对象\n     *      getSync、setSync是通过调用扩展运行页面window对象实现的同步方法\n     */\n    getAsync(key) {\n        return new Promise(resolve => {\n            chrome.runtime.sendMessage({\n                action: 'getOption',\n                key\n            }, resolve);\n        });\n    },\n    setAsync(key, value) {\n        return new Promise(resolve => {\n            chrome.runtime.sendMessage({\n                action: 'setOption',\n                key,\n                value\n            }, resolve);\n        });\n    },\n\n    getSync(key) {\n        return backgroundWindow.extensionOptions.get(key);\n    },\n    setSync(...args) {\n        return backgroundWindow.extensionOptions.set(...args);\n    }\n});\n\n\n\n// WEBPACK FOOTER //\n// app/utils/options.js"],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;A;;;;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAvBA;AAyBA;AACA;AACA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AAEA;AACA;AACA;AACA;AACA;AADA;AACA;AAGA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5CA;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAlBA;AAoBA;;;;;AAKA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AA7BA;;;;A","sourceRoot":""}